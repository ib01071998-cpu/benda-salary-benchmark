def generate_salary_table(job_title, experience, df):
    exp_text = "בהתאם לממוצע השוק" if experience == 0 else f"עבור {experience} שנות ניסיון"
    live_summary = "לא נמצאו נתוני אמת – יוצג בנצ'מארק ממוצע." if df.empty else f"נתוני אמת משוק העבודה בישראל:\n{df.to_string(index=False)}"

    prompt = f"""
{live_summary}

צור טבלת בנצ'מארק שכר מדויקת ומקיפה לתפקיד "{job_title}" בישראל {exp_text} לשנת 2025.

🧠 מטרתך: להציג תמונה אמיתית ומבוססת של מבנה השכר בישראל, כולל טווחים ריאליים, מנגנוני תגמול מפורטים והשלמה של רכיבים רלוונטיים למשרה.

השתמש במידע ממקורות ישראליים בלבד והסתמך על סטנדרטים מקובלים בענף.

📊 כל שורה בטבלה תכלול:
- רכיב שכר (לדוג׳: שכר בסיס, עמלות, בונוס, רכב חברה, קרן השתלמות וכו׳)
- טווח שכר או אחוזים בהתאם לסוג הרכיב:
    • אם הרכיב הוא כספי (שכר, בונוס, רכב, סיבוס וכו׳) → הצג טווח בש"ח (לדוג׳ ‎10,000–15,000 ₪)
    • אם הרכיב הוא מבוסס אחוזים (עמלות, תגמולים, אחוז הצלחה וכו׳) → הצג טווח באחוזים בלבד (לדוג׳ ‎3%–7%)
    • אם מדובר בקרן השתלמות / פנסיה → הצג אחוזים מהשכר (לדוג׳ ‎6.5%–7.5%)
    • אם מדובר באופציות / RSU → הצג אחוז אחזקה או טווח שנתי בש"ח
- שלוש רמות תגמול (בסיסית / בינונית / גבוהה)
- ממוצע שוק (₪ או % בהתאם לסוג הרכיב)
- מנגנון תגמול מפורט ומציאותי — כולל נוסחת חישוב, מדרגות, תקרות, תדירות, ודוגמה מספרית מציאותית.
- עלות מעסיק ממוצעת (₪)
- אחוז מסך עלות השכר הכוללת (%)

📌 ודא כי:
- כל טווח שכר מבוסס על יחס הגיוני (מקסימום ≈ 1.2–1.5 × מינימום)
- הממוצע הוא (מינימום + מקסימום)/2
- הסכומים מוצגים בצורה אחידה וברורה לפי סוג הרכיב
- אין ערבוב בין אחוזים לשקלים באותה שורה
- כל רכיב מוצג פעם אחת בלבד
- אם המשרה כוללת רכיבים רלוונטיים נוספים (כמו רכב, טלפון, ביטוחים, אחזקת רכב, שעות נוספות, אש"ל וכו׳) – הוסף אותם אוטומטית.

⚠️ ברכיב "רכב חברה":
- הצג את **שווי השוק של הרכב** (לדוג׳ 150,000 ₪)
- הצג שלושה דגמים מתאימים לשווי זה (לדוג׳ טויוטה קאמרי, סקודה סופרב, מאזדה 6)
- בעמודת "עלות מעסיק ממוצעת" הצג את **זקיפת השווי לעובד בלבד** (לדוג׳ 3,000 ₪ לחודש עבור רכב קבוצה 4)
- ציין את הזקיפה כשווי הטבה ממוצע, לא עלות למעסיק.

בסוף הדוח הוסף שורה מסכמת אחת בלבד:
"סה״כ עלות מעסיק כוללת (₪)" — חישוב מבוסס סך הטווחים בטבלה.

⚙️ טווחי דוגמה להכוונה בלבד:
- עמלות: ‎2%–8% מהמכירות
- שכר בסיס למנהלים: ‎18,000–26,000 ₪
- בונוס עמידה ביעדים: ‎5,000–12,000 ₪
- קרן השתלמות: ‎7.5%
- אש"ל: ‎600–1,000 ₪
- זקיפת רכב: ‎3,000 ₪
- ביטוחים: ‎400–800 ₪
"""
    r = client.chat.completions.create(
        model="gpt-4-turbo",
        messages=[
            {"role": "system", "content": "אתה אנליסט שכר בכיר בישראל. הפלט הוא טבלה אחת בלבד בעברית, ללא טקסט נוסף."},
            {"role": "user", "content": prompt}
        ],
        temperature=0.15,
    )
    return r.choices[0].message.content
